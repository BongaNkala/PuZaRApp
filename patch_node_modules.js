const fs = require('fs');
const path = require('path');

console.log('Patching node_modules to disable NDK requirements...');

// Function to patch build.gradle files
function patchBuildGradle(filePath) {
    if (!fs.existsSync(filePath)) return;
    
    let content = fs.readFileSync(filePath, 'utf8');
    let original = content;
    
    // Remove externalNativeBuild blocks
    content = content.replace(/externalNativeBuild\s*\{[\s\S]*?\n\s*\}/g, '');
    
    // Remove prefab blocks
    content = content.replace(/prefab\s*\{[\s\S]*?\n\s*\}/g, '');
    content = content.replace(/prefabPublishing\s*\{[\s\S]*?\n\s*\}/g, '');
    
    // Remove cmake blocks
    content = content.replace(/cmake\s*\{[\s\S]*?\n\s*\}/g, '');
    
    if (content !== original) {
        fs.writeFileSync(filePath, content);
        console.log(`  Patched: ${filePath}`);
    }
}

// Patch expo-modules-core
patchBuildGradle(path.join(__dirname, 'node_modules/expo-modules-core/android/build.gradle'));

// Patch react-native-screens
patchBuildGradle(path.join(__dirname, 'node_modules/react-native-screens/android/build.gradle'));

console.log('âœ“ Node modules patched');
